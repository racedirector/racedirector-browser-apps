<!DOCTYPE html>
<html>
<head>
	<meta charset="utf-8">
	<meta name="viewport" content="width=device-width, initial-scale=1">
	<title>ABS Indicator</title>
	<meta name="author" content="Mihail Latyshov" />
	<style>html,body{height:100%}body{margin:0;display:flex;justify-content:center;align-items:center;box-sizing:border-box;padding:10px 0}body.hidden{display:none}svg{width:100%;height:100%;color:var(--color,#1a1a1a)}svg.active{color:var(--color-active,#f0ac24)}</style>
</head>
<body class="hidden">
	<svg xmlns="http://www.w3.org/2000/svg" viewBox="0 0 100 70">
		<path d="m50.547.694c9.168 0 17.757 3.571 24.196 10.053 6.445 6.488 9.957 15.104 9.892 24.272-.128 18.905-15.612 34.287-34.517 34.287-9.174 0-17.763-3.576-24.202-10.053-6.445-6.487-9.957-15.109-9.892-24.277.139-18.905 15.623-34.282 34.523-34.282zm-.429 62.553c15.586 0 28.352-12.68 28.459-28.271.053-7.538-2.836-14.626-8.134-19.961-5.291-5.329-12.353-8.262-19.896-8.262-15.586 0-28.357 12.675-28.47 28.266-.048 7.544 2.836 14.637 8.133 19.961 5.292 5.329 12.364 8.267 19.908 8.267zm-38.979.467c-17.419-20.819-9.447-44.887 1.051-57.899l6.268 5.147c-8.632 10.696-15.184 30.485-.863 47.605zm70.95-5.147c14.572-17.12 8.283-36.904-.193-47.605l6.332-5.147c10.321 13.012 17.961 37.085.252 57.899zm-51.418-18.026-1.12 3.737-3.496 0 5.935-19.725 4.976 0 5.865 19.725-3.42 0-1.137-3.737zm3.882-13.093-.043 0-3.05 10.225 6.08 0zm9.244 16.825.085-19.725 8.756 0c3.447 0 5.184.788 5.163 5.131-.011 2.262-.397 3.785-2.531 4.359l0 .107c2.461.322 2.922 2.134 2.906 4.632-.016 4.365-1.619 5.496-5.324 5.496zm3.393-3.238 4.622 0c2.016 0 2.981-.156 2.992-2.574.005-2.161-.408-2.788-2.408-2.788l-5.184 0zm.033-8.225 4.862 0c1.898 0 2.322-.665 2.333-2.767.01-2.101-.746-2.262-2.408-2.262l-4.761 0zm15.58 5.179-.005.917c-.006 2.263.858 2.418 3.983 2.418 3.067 0 3.496-.627 3.507-2.917.016-2.809-1.324-2.445-3.957-2.6-3.796-.263-6.804-.107-6.777-5.839.027-5.42 3.078-5.576 7.297-5.576 3.592 0 6.525.134 6.504 5.314l0 .632-3.383 0 0-.632c.016-2.129-.762-2.215-3.132-2.215-3.356 0-3.897.37-3.908 2.477-.005 2.418.434 2.493 3.86 2.735 5.421.37 6.895.686 6.874 5.704-.022 5.55-2.37 6.021-6.901 6.021-3.892 0-7.366.134-7.345-5.522l.005-.917z" fill="currentColor"/>
	</svg>
	<script>(()=>{var t={745:(t,e,r)=>{var n,s=[].indexOf;n=r(165),t.exports=class extends n{constructor(){super(...arguments),this.emitter=new EventTarget,this.isTest=!1,this.emitApply=!1,this.proxyData={updatedKeys:new Set,old:{},data:{},watching:[]},this.proxy=new Proxy(this.proxyData,{set:function(t,e,r){return t.data[e]!==r&&(t.updatedKeys.add(e),t.data[e]=r),!0}}),this.onConnect=(t=!0)=>{if(this.proxy.connected=!0,t)return this.apply()},this.onDisconnect=(t=!0)=>{var e;for(e in this.proxy.connected=!1,t&&this.apply(),this.proxyData.updatedKeys.clear(),this.proxyData.old={},this.proxyData.data)delete this.proxyData.data[e];return this.proxyData.watching.forEach((function(t){return t.firstPass=!0}))},this.onUpdate=(t,e=!0,r=!1)=>{var n,s,a;if(!this.isTest||r){for(n=0,a=t.length;n<a;n++)s=t[n],this.proxy[s]=this.data[s];return e?this.apply():void 0}},this.onBroadcast=t=>this.emit("broadcast",t)}getData(){return this.proxyData.data}apply(){var t,e,r,n,a,i,o,c,h,d;for(this.applying=!0,d=this.proxyData.watching;d.length;){for(o=d.slice(0),e=0,a=d.length;e<a;e++)(h=d[e]).cancel||this.applyWatcher(h);d=d.filter((function(t){return s.call(o,t)<0}))}for(c=this.proxyData.watching.filter((function(t){return t.cancel})),n=0,i=c.length;n<i;n++)h=c[n],t=this.proxyData.watching.findIndex((function(t){return t===h})),this.proxyData.watching.splice(t,1);for(r of this.proxyData.updatedKeys)this.proxyData.old[r]=this.proxyData.data[r];if(this.proxyData.updatedKeys.clear(),this.applying=!1,this.emitApply)return this.emit("apply")}applyWatcher(t){var e,r,n,s,a,i,o,c;for(i=[],o=[],e=!1,r=n=0,a=(c=t.keys).length;n<a;r=++n)s=c[r],this.proxyData.updatedKeys.has(s)?(i[r]=this.proxyData.data[s],o[r]=this.proxyData.old[s],e=!0):i[r]=o[r]=this.proxyData.data[s];if(t.firstPass&&(t.firstPass=!1,e=i.some((function(t){return null!=t}))),e)return 1===i.length?t.callback(i[0],o[0]):t.callback(i,o)}watch(t,e){var r;return"string"==typeof t&&(t=[t]),this.proxyData.watching.push(r={keys:t,firstPass:!0,callback:e}),function(t){return t.cancel=!0}.bind(this,r)}emit(t,e){return this.emitter.dispatchEvent(new CustomEvent(t,{detail:e}))}}},165:(t,e,r)=>{t=r.nmd(t);var n,s=[].indexOf;n=class{constructor(t=[],e=[],r=1,n="127.0.0.1:8182",s=!1,a=null,i=null){this.requestParams=t,this.requestParamsOnce=e,this.fps=r,this.server=n,this.readIbt=s,this.record=a,this.zipLibPath=i,this.data={},this.onConnect=null,this.onDisconnect=null,this.onUpdate=null,this.onBroadcast=null,this.ws=null,this.onWSConnect=null,this.onWSDisconnect=null,this.reconnectTimeout=null,this.connected=!1,this.firstTimeConnect=!0,null!=this.record&&this.loadRecord(),this.connect()}connect(){return this.ws=new WebSocket(`ws://${this.server}/ws`),this.ws.onopen=(...t)=>this.onopen(...t),this.ws.onmessage=(...t)=>this.onmessage(...t),this.ws.onclose=(...t)=>this.onclose(...t)}close(){return this.ws.onclose=null,this.ws.close()}onopen(){var t;if("function"==typeof this.onWSConnect&&this.onWSConnect(),null!=this.reconnectTimeout&&clearTimeout(this.reconnectTimeout),null==this.record){for(t in this.data)delete this.data[t];return this.ws.send(JSON.stringify({fps:this.fps,readIbt:this.readIbt,requestParams:this.requestParams,requestParamsOnce:this.requestParamsOnce}))}}onmessage(t){var e,r,n,s,a;if(e=JSON.parse(t.data),null==this.record){if(e.disconnected&&(this.connected=!1,"function"==typeof this.onDisconnect&&this.onDisconnect()),e.connected)for(r in this.data)delete this.data[r];if((e.connected||this.firstTimeConnect&&!this.connected&&!e.broadcast)&&(this.firstTimeConnect=!1,this.connected=!0,"function"==typeof this.onConnect&&this.onConnect()),e.data){for(r in n=[],s=e.data)a=s[r],n.push(r),this.data[r]=a;"function"==typeof this.onUpdate&&this.onUpdate(n)}}if(e.broadcast)return"function"==typeof this.onBroadcast?this.onBroadcast(e.broadcast):void 0}onclose(){return"function"==typeof this.onWSDisconnect&&this.onWSDisconnect(),this.ws&&(this.ws.onopen=this.ws.onmessage=this.ws.onclose=null),this.connected&&(this.connected=!1,null==this.record&&"function"==typeof this.onDisconnect&&this.onDisconnect()),this.reconnectTimeout=setTimeout((()=>this.connect.apply(this)),2e3)}sendCommand(t,...e){return this.ws.send(JSON.stringify({command:t,args:e}))}broadcast(t){return this.ws.send(JSON.stringify({broadcast:t}))}loadRecord(){var t,e;return t=this.zipLibPath&&-1!==this.record.search(/\.zip$/i),(e=new XMLHttpRequest).onreadystatechange=()=>{var r,n;if(4===e.readyState&&200===e.status)return t?(r=document.head,(n=document.createElement("script")).src=this.zipLibPath+"zip.js",r.appendChild(n),n.addEventListener("load",(()=>{var t;return zip.useWebWorkers=!1,(t=document.createElement("script")).src=this.zipLibPath+"inflate.js",r.appendChild(t),t.addEventListener("load",(()=>zip.createReader(new zip.BlobReader(e.response),(e=>e.getEntries((s=>s[0].getData(new zip.TextWriter,(s=>(e.close(),r.removeChild(t),r.removeChild(n),this.onRecord(JSON.parse(s)))))))))))}))):this.onRecord(e.response)},e.open("GET",this.record,!0),e.responseType=t?"blob":"json",e.send()}onRecord(t){return this.connected=!0,"connected"in t[0]||t.unshift({connected:!0}),this.record={frames:t,requestedParamsOnce:[]},"function"==typeof this.onConnect?this.onConnect():void 0}playRecord(t=0,e=null,r=1){var n;for(this.record.currentFrame=0,"function"==typeof this.onConnect&&this.onConnect(!1),n=t;n-- >=0;)this.record.currentFrame++,this.playRecordFrame(!1);return null!=this.record.playInterval&&clearInterval(this.record.playInterval),!r||null!=e&&t>=e?this.record.currentFrame<this.record.frames.length-1?setTimeout((()=>(this.record.currentFrame++,this.playRecordFrame())),1):void 0:this.record.playInterval=setInterval((()=>this.record.currentFrame<this.record.frames.length-1&&!(null!=e&&this.record.currentFrame>=e)?(this.record.currentFrame++,this.playRecordFrame()):clearInterval(this.record.playInterval)),1e3/r)}resetRecord(){return null!=this.record.playInterval&&clearInterval(this.record.playInterval),setTimeout((()=>{var t;for(t in this.record.requestedParamsOnce=[],this.data)delete this.data[t];return"function"==typeof this.onDisconnect&&this.onDisconnect(),setTimeout((()=>"function"==typeof this.onConnect?this.onConnect():void 0),500)}),100)}playRecordFrame(t=!0){var e,r,n,a,i;if(null!=(e=this.record.frames[this.record.currentFrame])?e.data:void 0){for(r in n=[],a=e.data)i=a[r],(s.call(this.requestParams,"__all_telemetry__")>=0||s.call(this.requestParams,r)>=0||s.call(this.requestParamsOnce,r)>=0&&s.call(this.record.requestedParamsOnce,r)<0)&&(n.push(r),this.data[r]=i,s.call(this.requestParamsOnce,r)>=0&&s.call(this.record.requestedParamsOnce,r)<0&&this.record.requestedParamsOnce.push(r));return"function"==typeof this.onUpdate?this.onUpdate(n,t):void 0}}},"undefined"!=typeof window&&null!==window&&(window.IRacing=n),null!=(null!==t?t.exports:void 0)&&(t.exports=n)}},e={};function r(n){var s=e[n];if(void 0!==s)return s.exports;var a=e[n]={id:n,loaded:!1,exports:{}};return t[n](a,a.exports,r),a.loaded=!0,a.exports}r.nmd=t=>(t.paths=[],t.children||(t.children=[]),t),(()=>{var t,e,n,s,a,i,o,c,h,d,l,u,p,f=[].indexOf;for(p of(t=r(745),e={},new URLSearchParams(location.search)))[o,u]=p,e[o]=/^\d{1,10}$/.test(u)?parseInt(u):u;i=new t(["BrakeABSactive","DriverInfo"],[],60,e.host||"127.0.0.1:8182"),a=i.getData(),d=document.querySelector("svg"),e.color&&d.style.setProperty("--color",e.color),e.colorActive&&d.style.setProperty("--color-active",e.colorActive),h="kapps-widgets.abs-indicator";try{c=JSON.parse(localStorage.getItem(h))}catch(t){}null==c&&(c={carIds:[]}),n=null,s=!1,i.watch("connected",(function(t,e){return n=null,s=!1,document.body.classList.add("hidden"),d.classList.remove("active")})),i.watch("DriverInfo",(function(t,e){var r;try{return r=(n=a.DriverInfo.Drivers.find((function(t){return t.CarIdx===a.DriverInfo.DriverCarIdx}))).CarID,s=f.call(c.carIds,r)>=0,document.body.classList.toggle("hidden",!s)}catch(t){}})),i.watch("BrakeABSactive",(function(t,e){var r;if(!s&&t&&(r=n.CarID,f.call(c.carIds,r)<0)&&(c.carIds.push(n.CarID),localStorage.setItem(h,JSON.stringify(c)),document.body.classList.remove("hidden"),s=!0),s)return l()})),l=function(){return d.classList.toggle("active",a.connected&&a.BrakeABSactive)}})()})();</script>
</body>
</html>
